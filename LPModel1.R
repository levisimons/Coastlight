#Quick script for plotting variance measures of sky brightness for poster.
require(dplyr)
require(ggplot2)

wd <- "~/Desktop/Coastlight"
setwd(wd)

#Read in data generated by SQC batch analysis.
SQCData <- read.table("CoastlightPosterData.csv", header=TRUE, sep=",",as.is=T,skip=0,fill=TRUE,check.names=FALSE)
#Read in field data.
FieldData <- read.table("CoastlightFieldData.csv", header=TRUE, sep=",",as.is=T,skip=0,fill=TRUE,check.names=FALSE)

#Keep batch analysis data for images with zero horizon.
SQCDataZeroHorizon <- SQCData[!grepl("Horizon",SQCData$SQCFileName),]

#Keep batch analysis data for images with edited horizon.
SQCDataEditedHorizon <- SQCData[grepl("Horizon",SQCData$SQCFileName),]

#Zero-horizon merged data set
FieldSQCMergeZH <- merge(FieldData,SQCDataZeroHorizon,by.x=c("SQCSiteName"),by.y=c("Location"))
#Edited-horizon merged data set
FieldSQCMergeEH <- merge(FieldData,SQCDataEditedHorizon,by.x=c("SQCSiteName"),by.y=c("Location"))

#Plot data for zero-horizon images
LPPlotZH <- ggplot(FieldSQCMergeZH, aes(x=`SQM2015Atlas (mcd/m^2)`,y=log(ScalarIlluminance),color=Clouds))+geom_point()+geom_smooth(method=glm, aes(fill=ScalarIlluminance))
LPPlotZH+xlab("SQM2015Atlas (mcd/m^2)")+ylab("Log(Scalar Illuminance (mlx)")+ggtitle("Log of Scalar Illuminance (Field data) vs. SQM Atlas (Satellite data)\nZero Horizon")+scale_color_gradientn("% Cloud cover",colours = rainbow(5))

#Plot data for horizon-edited images
LPPlotEH <- ggplot(FieldSQCMergeEH, aes(x=`SQM2015Atlas (mcd/m^2)`,y=log(ScalarIlluminance),color=Clouds))+geom_point()+geom_smooth(method=glm, aes(fill=ScalarIlluminance))
LPPlotEH+xlab("SQM2015Atlas (mcd/m^2)")+ylab("Log(Scalar Illuminance (mlx))")+ggtitle("Log of Scalar Illuminance (Field data) vs. SQM Atlas (Satellite data)\nEdited Horizon")+scale_color_gradientn("% Cloud cover",colours = rainbow(5))
